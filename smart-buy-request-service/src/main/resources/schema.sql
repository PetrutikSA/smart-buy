CREATE TABLE IF NOT EXISTS users (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  chat_id BIGINT NOT NULL,
  CONSTRAINT pk_users PRIMARY KEY (id),
  CONSTRAINT uq_chat_id UNIQUE (chat_id)
);

CREATE TABLE IF NOT EXISTS requests (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  request_number INT NOT NULL,
  search_query VARCHAR NOT NULL,
  max_price DECIMAL(10,2),
  isUpdated BOOLEAN,
  CONSTRAINT pk_requests PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS products (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  url VARCHAR NOT NULL,
  price DECIMAL(10,2),
  CONSTRAINT pk_products PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS requests_results (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  request_id BIGINT NOT NULL REFERENCES requests(id) ON DELETE CASCADE,
  product_id BIGINT NOT NULL REFERENCES products(id) ON DELETE CASCADE,
  CONSTRAINT pk_requests_results PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS requests_bans (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  request_id BIGINT NOT NULL REFERENCES requests(id) ON DELETE CASCADE,
  product_id BIGINT NOT NULL REFERENCES products(id) ON DELETE CASCADE,
  CONSTRAINT pk_requests_bans PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS users_requests (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  user_id BIGINT NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  request_id BIGINT NOT NULL REFERENCES requests(id) ON DELETE CASCADE,
  CONSTRAINT pk_users_requests PRIMARY KEY (id)
);