CREATE TABLE IF NOT EXISTS users (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  chat_id BIGINT NOT NULL,
  CONSTRAINT pk_users PRIMARY KEY (id),
  CONSTRAINT uq_chat_id UNIQUE (chat_id)
);

CREATE TABLE IF NOT EXISTS requests (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  request_number INT NOT NULL,
  search_query VARCHAR NOT NULL,
  max_price DECIMAL(10,2),
  user_id BIGINT REFERENCES users(id) ON DELETE CASCADE,
  is_updated BOOLEAN,
  CONSTRAINT pk_requests PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS products (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  url VARCHAR NOT NULL,
  price DECIMAL(10,2),
  request_id BIGINT REFERENCES requests(id) ON DELETE CASCADE,
  is_new BOOLEAN,
  is_banned BOOLEAN,
  CONSTRAINT pk_products PRIMARY KEY (id)
);